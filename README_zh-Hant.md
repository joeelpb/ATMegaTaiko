# 太鼓鼓控制器 - Arduino Pro Micro (ATmega32U4)

![太鼓鼓控制器](./images/ATMegaTaiko.png)

一個開源硬件專案，幫助你製作自己的**太鼓達人**PC控制器。

[查看簡體中文版](./README_zh-Hans.md) | [查看日文版](./README_Japanese.md) | [View English Version](./README.md)

## 關於本專案

本專案旨在幫助你創建一個自定義的太鼓達人控制器，讓你在家中享受街機體驗。

> **注意：** 本專案僅供個人和非商業用途。

---

## 所需材料

製作太鼓鼓控制器所需的材料：

1. **Arduino Micro/Leonardo**（帶ATmega32U4微控制器）
2. **4個壓電傳感器**
3. **4個100kΩ電阻**
4. 基本電子元件（如麵包板、跳線）
5. 木板和切割工具（僅在你從頭開始製作鼓時需要）  
   > 如果你有售後市場的Taiko Force Lv5，也可以直接使用它。

---

## 製作步驟

1. **準備鼓**  
   製作鼓並將4個壓電傳感器牢固地黏在上面。參考下圖查看傳感器的推薦位置。

   ![傳感器安裝](./images/piezo_locations.png)

2. **連接組件**  
   按下圖所示將壓電傳感器和其他組件連接到Arduino。  
   > 注意：壓電傳感器的極性無關緊要。本設計適用於Arduino Micro，如果使用其他板子，請參考其文件。

   ![控制器電路圖](./images/scheme.png)

3. **燒錄韌體**  
   將韌體上傳到Arduino板上。可能需要調整一些參數，例如 `SAMPLE_CACHE_LENGTH`、`HIT_THRES`、`RESET_THRES` 和 `sensitivity`，詳情見下文。

4. **開始遊戲！**  
   設置完成後，控制器就可以使用了。

---

## 參數調整

1. **命中和重置閾值**  
   設置 `DEBUG 1` 以禁用鍵盤輸出，並透過串口監視信號值。滾動鼓的4個區域之一，觀察串口監視器的輸出圖形。  
   - **命中閾值**：應低於你最重的敲擊。
   - **重置閾值**：應高於滾動敲擊之間的低點（波谷）並低於命中值。  

   對每個鼓區重複此過程以找到最佳閾值。

   ![設置命中和重置值](./images/tune_hit_reset.png)

2. **採樣長度**  
   在 `cache.h` 中將 `SAMPLE_CACHE_LENGTH` 設置為2的冪（如2、8、16、32）。對於Arduino，**16** 是最佳值；如果你使用更快的微控制器（採樣速度達到4000Hz或更高），可以設置為 **32**，以獲得更平滑的信號。

3. **傳感器靈敏度**  
   傳感器輸出可能會有所不同。使用 `sensitivity` 參數來規範差異。例如，如果 **右-don** 區域輸出較高的值，可以將 `sensitivity` 設置為 `{1.0, 1.0, 0.5, 1.0}` 來平衡響應。

   ![設置靈敏度](./images/tune_sensitivities.png)

   > 傳感器的安裝非常關鍵。確保傳感器牢固地附著在鼓上。

4. **啟動遊戲**  
   調整完成後，啟動遊戲並享受你的自定義太鼓控制器！

---
